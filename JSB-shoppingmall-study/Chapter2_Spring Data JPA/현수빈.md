# Chapter 2. Spring Data JPA

### JPA : 자바 ORM 기술에 대한 API 표준
ORM(Object Relational Mapping) : 객체와 관계형 데이터베이스를 매핑해주는 것

### JPA란?
JPA는 인터페이스고 이를 구현한 대표적인 구현체로 Hibernate, EclipseLink, DataNucleus, OpenJpa, TopLink 등이 있다. JPA 인터페이스를 구현한 가장 대표적인 오픈소스가 Hibernate이다.

JPA 사용 시 장점

1. 특정 데이터베이스에 종속되지 않음
2. 객체지향적 프로그래밍
3. 생산성 향상

JPA 사용 시 단점

1. 복잡한 쿼리 처리
2. 성능 저하 위험
3. 학습 시간

### JPA 동작 방식

엔티티 : 데이터베이스의 테이블에 대응하는 클래스, @Entity가 붙은 클래스는 JPA에서 관리

엔티티 매니저 팩토리 : 엔티티 매니저 인스턴스를 관리하는 주체

엔티티 매니저 : 영속성 컨텍스트에 접근하여 엔티티에 대한 데이터베이스 작업을 제공. 내부적으로 데이터베이스 커넥션을 사용해 데이터베이스에 접근

1. find() : 영속성 컨텍스트에서 엔티티를 검색하고 영속성 컨텍스트에 없을 경우 데이터베이스에서 데이터를 찾아 영속성 컨텍스트에 저장
2. persistant() : 엔티티를 영속성 컨텍스트에 저장
3. remove() : 엔티티 클래스를 영속성 컨텍스트에서 삭제
4. flush() : 영속성 컨텍스트에 저장된 내용을 데이터베이스에 반영

영속성 컨텍스트 

영속성 컨텍스트 사용 시 이점
- 1차 캐시 : Map<KEY, VALUE>로 저장. entityManager.find() 메소드 호출 시 영속성 컨텍스트의 1차 캐시를 조회. 엔티티가 존재할 경우 해당 엔티티를 반환하고, 엔티티가 없으면 데이터베이스에서 조회 후 1차 캐시에 저장 및 반환
- 동일성 보장 : 하나의 트랜잭션에서 같은 키 값으로 영속성 컨텍스트에 저장된 엔티티 조회 시 같은 엔티티 조회를 보장. 
- 트랜잭션을 지원하는 쓰기 지연 : 영속성 컨텍스트에는 쓰기 지연 SQL 존재. entityManager.persist()를 호출하면 1차 캐시에 저장되는 것과 동시에 쓰기 지연 SQL 저장소에 SQL문이 저장됨.
- 변경 감지 : 1차 캐시에 저장된 엔티티와 스냅샷을 비교 후 변경 내용이 있다면 UPDATE SQL문을 쓰기 지연 SQL 저장소에 담아둔다. 그리고 데이터베이스에 커밋 시점에 변경 내용을 자동으로 반영한다. 


